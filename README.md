# Отчет: Расчет экономики AI-проекта

## Модель, использованная для анализа
**Claude Sonnet 4.5** (model ID: claude-sonnet-4-5-20250929)

## История промптинга

### 1. Анализ задания и извлечение данных
Первый этап - получение данных из Excel файла `prilozhenie.xlsx`. Данные содержали:
- Длины входных и выходных текстов для каждой функции (в символах)
- Системный промпт длиной 5000 символов для каждой функции

### 2. Поиск актуальных расценок OpenAI
Для получения актуальных данных о ценах был проведен веб-поиск с запросом: "OpenAI API pricing 2025 GPT-4 DALL-E TTS pricing"

Найденные расценки (по состоянию на декабрь 2025):
- **GPT-4o**: $2.50 за 1M входных токенов, $10.00 за 1M выходных токенов
- **DALL-E 3** (1024x1024 standard): $0.04 за изображение
- **TTS Standard**: $15.00 за 1M символов
- **GPT-4o Vision**: использует токены для обработки изображений (~1100 токенов для high-detail)

## Выбор моделей для каждой функции

### 1. Утреннее приветствие (картинка + стих)
- **Для генерации стиха**: GPT-4o
  - Причина: оптимальное соотношение качества и цены для творческих текстов
- **Для генерации картинки**: DALL-E 3
  - Причина: единственный доступный вариант генерации изображений в OpenAI API

### 2. Вечерний отчет о настроении
- **Модель**: GPT-4o
  - Причина: подходит для диалоговых сценариев, хорошо понимает эмоции и контекст

### 3. Недельный подкаст
- **Для анализа настроения**: GPT-4o
  - Причина: способность анализировать большие объемы текста (7000 символов)
- **Для озвучки**: TTS Standard
  - Причина: достаточное качество для подкастов, экономичнее чем TTS HD

### 4. Оценка внешности
- **Модель**: GPT-4o Vision
  - Причина: единственная доступная опция для анализа изображений с текстовыми рекомендациями

### 5. Регистрация (аватарка + звание)
- **Для генерации звания**: GPT-4o
  - Причина: хорошо справляется с креативными короткими текстами
- **Для генерации аватарки**: DALL-E 3
  - Причина: качественная генерация аватарок

## Детальный расчет стоимости

### Исходные данные
- Начальное количество пользователей: **1000**
- Прирост: **+100 пользователей каждую неделю**
- Период расчета: **8 недель (2 месяца)**
- Пользователи по неделям: [1000, 1100, 1200, 1300, 1400, 1500, 1600, 1700]
- Всего новых пользователей за период: **1800**

### Коэффициенты конверсии
Для русского языка: **1 токен ≈ 2.5 символа**
(Токенизация русского текста менее эффективна, чем английского)

### Расчет по функциям

#### 1. Утреннее приветствие
**Частота**: Ежедневно (7 раз в неделю на пользователя)

**Расчет токенов:**
- Входные данные: системный промпт (5000 символов) + промпт для картинки (200 символов) = 5200 символов = 2080 токенов
- Выходные данные: стих (500 символов) = 200 токенов

**Стоимость GPT-4o за запрос:**
- Input: (2080 / 1,000,000) × $2.50 = $0.0052
- Output: (200 / 1,000,000) × $10.00 = $0.0020
- Итого GPT-4o: $0.0072

**Стоимость DALL-E за запрос:** $0.04

**Общая стоимость за запрос:** $0.0472

**Общее количество запросов за 8 недель:**
(1000 + 1100 + 1200 + 1300 + 1400 + 1500 + 1600 + 1700) × 7 = 75,600 запросов

**Итого за 2 месяца:** $3,568.32

---

#### 2. Вечерний отчет о настроении
**Частота**: Ежедневно (7 раз в неделю на пользователя)

**Расчет токенов:**
- Входные данные: системный промпт (5000 символов) + сообщение пользователя (1000 символов) = 6000 символов = 2400 токенов
- Выходные данные: ответ (300 символов) = 120 токенов

**Стоимость за запрос:**
- Input: (2400 / 1,000,000) × $2.50 = $0.0060
- Output: (120 / 1,000,000) × $10.00 = $0.0012
- Итого: $0.0072

**Общее количество запросов:** 75,600

**Итого за 2 месяца:** $544.32

---

#### 3. Недельный подкаст
**Частота**: Еженедельно (1 раз в неделю на пользователя)

**Расчет токенов для GPT-4o:**
- Входные данные: системный промпт (5000 символов) + недельные данные (7000 символов) = 12,000 символов = 4800 токенов
- Выходные данные: текст для озвучки (2000 символов) = 800 токенов

**Стоимость GPT-4o за запрос:**
- Input: (4800 / 1,000,000) × $2.50 = $0.0120
- Output: (800 / 1,000,000) × $10.00 = $0.0080
- Итого GPT-4o: $0.0200

**Стоимость TTS за запрос:**
- (2000 / 1,000,000) × $15.00 = $0.0300

**Общая стоимость за запрос:** $0.0500

**Общее количество запросов:** 10,800 (сумма пользователей по неделям)

**Итого за 2 месяца:** $540.00

---

#### 4. Оценка внешности (Vision)
**Частота**: В среднем 1 раз в 3 дня (≈2.33 раза в неделю на пользователя)

**Расчет токенов:**
- Входные данные: системный промпт (5000 символов = 2000 токенов) + изображение (1100 токенов high-detail) = 3100 токенов
- Выходные данные: рекомендации (600 символов) = 240 токенов

**Стоимость за запрос:**
- Input: (3100 / 1,000,000) × $2.50 = $0.00775
- Output: (240 / 1,000,000) × $10.00 = $0.00240
- Итого: $0.01015

**Общее количество запросов:** ≈25,200 (сумма пользователей × 2.33)

**Итого за 2 месяца:** $255.78

---

#### 5. Регистрация (аватарка + звание)
**Частота**: Один раз при регистрации нового пользователя

**Расчет токенов для GPT-4o:**
- Входные данные: системный промпт (5000 символов) + промпт для аватарки (150 символов) = 5150 символов = 2060 токенов
- Выходные данные: звание (100 символов) = 40 токенов

**Стоимость GPT-4o за пользователя:**
- Input: (2060 / 1,000,000) × $2.50 = $0.00515
- Output: (40 / 1,000,000) × $10.00 = $0.00040
- Итого GPT-4o: $0.00555

**Стоимость DALL-E за пользователя:** $0.04

**Общая стоимость на пользователя:** $0.04555

**Общее количество новых пользователей:** 1800

**Итого за 2 месяца:** $81.99

---

## Итоговая стоимость проекта

| Функция | Стоимость (USD) |
|---------|-----------------|
| 1. Утреннее приветствие | $3,568.32 |
| 2. Вечерний отчет о настроении | $544.32 |
| 3. Недельный подкаст | $540.00 |
| 4. Оценка внешности | $255.78 |
| 5. Регистрация | $81.99 |
| **ВСЕГО ЗА 2 МЕСЯЦА** | **$4,990.41** |

## Разбивка по типам API

| Тип API | Стоимость (USD) |
|---------|-----------------|
| GPT-4o (текст + Vision) | $1,570.41 |
| DALL-E 3 (изображения) | $3,096.00 |
| TTS (озвучка) | $324.00 |
| **ИТОГО** | **$4,990.41** |

## Способы оптимизации и экономии токенов

### 1. Оптимизация системных промптов
**Текущая ситуация**: Каждый запрос включает системный промпт в 5000 символов (2000 токенов)

**Оптимизация**:
- Сократить системный промпт до 1000-1500 символов без потери качества
- Использовать более лаконичные инструкции
- **Экономия**: ~40-50% на input токенах ≈ **$500-600**

### 2. Кэширование промптов (Prompt Caching)
OpenAI поддерживает кэширование длинных системных промптов:
- Первый запрос: полная стоимость
- Последующие запросы в течение 5-10 минут: скидка 50-90% на кэшированную часть
- **Потенциальная экономия**: **$300-500** на повторяющихся запросах

### 3. Использование более дешевых моделей для простых задач
**Текущая ситуация**: Везде используется GPT-4o

**Оптимизация**:
- Вечерний отчет о настроении: использовать **GPT-4o-mini** (в 5-10 раз дешевле)
- Генерация званий при регистрации: использовать **GPT-4o-mini**
- **Экономия**: ≈ **$400-500**

### 4. Оптимизация DALL-E запросов
**Текущая ситуация**: Используется standard quality 1024x1024

**Оптимизация**:
- Аватарки: можно использовать DALL-E 2 (512x512 за $0.018) - экономия 55%
- Утренние картинки: оставить DALL-E 3 для качества
- **Экономия на аватарках**: 1800 × ($0.04 - $0.018) = **$39.60**

### 5. Batch API для неприоритетных задач
Для задач, которые можно выполнить с задержкой:
- Утренние приветствия можно генерировать ночью
- Batch API дешевле на 50%
- **Потенциальная экономия**: **$1,500-1,800** (если применять к утренним приветствиям)

### 6. Оптимизация частоты использования
**Текущая ситуация**:
- Утреннее приветствие: каждый день
- Вечерний отчет: каждый день

**Оптимизация**:
- Предлагать утреннее приветствие через день или по запросу
- Если 50% пользователей откажутся от ежедневных картинок: **экономия $1,784**

### 7. Оптимизация Vision запросов
**Текущая ситуация**: Используется high-detail режим (1100 токенов)

**Оптимизация**:
- Для простых фото использовать low-detail (85 токенов) - экономия 92%
- **Экономия**: ≈ **$235**

### 8. Сжатие выходных данных
- Генерировать более короткие стихи (300 символов вместо 500) - экономия 40% на output
- Более краткие рекомендации по внешности (400 вместо 600 символов)
- **Экономия**: ≈ **$200-300**

## Итоговая потенциальная экономия

| Метод оптимизации | Экономия (USD) |
|-------------------|----------------|
| Сокращение системных промптов | $500-600 |
| Prompt Caching | $300-500 |
| GPT-4o-mini для простых задач | $400-500 |
| DALL-E 2 для аватарок | $40 |
| Batch API для утренних приветствий | $1,500-1,800 |
| Снижение частоты (опционально) | $1,784 |
| Low-detail Vision | $235 |
| Сжатие выходных данных | $200-300 |
| **ИТОГО** | **$3,959-5,759** |

**Оптимизированная стоимость проекта: $1,231 - $2,789** (вместо $4,990)

**Экономия: 44-79%**

## Пограничные случаи и важные замечания

### 1. Рост нагрузки
При текущем приросте в 100 пользователей в неделю:
- Через 6 месяцев: ~3400 пользователей
- Через год: ~6200 пользователей
- Стоимость растет линейно с количеством пользователей

### 2. Пиковые нагрузки
Утренние приветствия генерируются примерно в одно время:
- Нужно учитывать rate limits OpenAI API
- Возможно потребуется распределенная генерация или батчинг

### 3. Качество vs стоимость
Использование более дешевых моделей может снизить качество:
- GPT-4o-mini может давать менее креативные ответы
- DALL-E 2 генерирует изображения худшего качества
- Необходимо тестирование перед внедрением

### 4. Злоупотребление системой
Некоторые пользователи могут:
- Многократно запрашивать оценку внешности
- Генерировать множество аватарок
- Рекомендуется внедрить rate limiting на стороне приложения

### 5. Сезонность использования
- В выходные использование может быть выше/ниже
- Праздники могут влиять на активность
- Текущий расчет предполагает равномерное использование

### 6. Ошибки и повторные запросы
В расчете не учтены:
- Таймауты API (обычно <1%)
- Ошибки 429 (rate limit)
- Невалидные ответы, требующие повторной генерации
- Рекомендуется заложить буфер +5-10% к итоговой сумме

### 7. Модерация контента
OpenAI может блокировать некоторые запросы:
- Оценка внешности может попадать под ограничения
- Необходима дополнительная модерация промптов
- Возможны дополнительные затраты на Moderation API (обычно бесплатно до определенного лимита)

## Проверка расчетов

Для проверки корректности расчетов был создан Python-скрипт [calculate_cost.py](calculate_cost.py), который:
1. Читает данные из Excel файла
2. Применяет актуальные расценки OpenAI
3. Рассчитывает стоимость для каждой функции
4. Суммирует итоговую стоимость

**Результат выполнения скрипта:**
```
ВСЕГО ЗА 2 МЕСЯЦА: $4,990.41
```

Расчет подтвержден и соответствует детальному анализу.

## Источники информации

- [OpenAI Pricing Official](https://openai.com/api/pricing/)
- [OpenAI API Pricing Documentation](https://platform.openai.com/docs/pricing)
- [OpenAI GPT-4o Pricing Guide 2025](https://blog.laozhang.ai/ai/openai-gpt-4o-api-pricing-guide/)
- [OpenAI API Pricing 2025 Guide](https://muneebdev.com/openai-api-pricing-2025/)
- [OpenAI TTS Pricing Calculator](https://costgoat.com/pricing/openai-tts)

---

**Дата создания отчета**: 12 декабря 2025
**Модель для анализа**: Claude Sonnet 4.5
**Версия расчета**: 1.0