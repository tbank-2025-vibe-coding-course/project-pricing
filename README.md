## Промптинг

использовал Claude Sonnet 4.5, в промпт закинул текст задания, приложил таблицу из задания, он не смог выкачать страницу openai.com/api/pricing, пошел искать по другим ресурсам, в итоге предлагал использовать gpt4o и DALL-E, после чего я скачал html `Pricing _OpenAI.html`, сказал использовать этот файл, claude завис почти на час. Перезапустил, добавив html в контекст, узнал, что у него лимит на чтение за один раз - 256kb, а html - 320kb, в итоге он решил парсить через питон и успешно сгенерил весь отчет ниже + `calculate_cost.py`. Все числа и из таблицы и из сайта распарсил правильно.

# Расчет экономики AI-проекта (2 месяца)

## Итоговая стоимость: **$1,256.59**

### Параметры проекта
- **Период:** 8 недель (2 месяца)
- **Стартовая база:** 1000 пользователей
- **Прирост:** +100 пользователей/неделю
- **Итого пользователей:** 1800
- **Средняя стоимость на пользователя:** $0.70

---

## Распределение затрат по функциям

| Функция | Стоимость | % от общей |
|---------|-----------|------------|
| Утреннее приветствие (картинка + стих) | $824.04 | 65.6% |
| Еженедельный подкаст | $203.04 | 16.2% |
| Оценка внешнего вида | $146.97 | 11.7% |
| Вечерний отчет о настроении | $63.50 | 5.1% |
| Регистрация (аватар + заголовок) | $19.04 | 1.5% |

**Основной расход:** Ежедневная генерация изображений съедает 65.6% бюджета.

---

## Выбор моделей (стратегия экономии)

### 1. Текстовые задачи: **gpt-5-mini**
- **Цена:** $0.25 / 1M input tokens, $2.00 / 1M output tokens
- **Применение:** стихи, анализ настроения, заголовки
- **Аргументация:** В 7 раз дешевле gpt-5.2 ($1.75/$14.00), достаточно для простых текстов

### 2. Генерация изображений: **gpt-image-1-mini (низкое качество)**
- **Цена:** ~$0.01 за изображение (низкое качество)
- **Применение:** утренние картинки, аватары при регистрации
- **Аргументация:** Экономия 94% vs высокое качество ($0.17). Для утренних приветствий не нужна высокая детализация

### 3. Синтез речи (TTS): **gpt-realtime-mini-audio**
- **Цена:** $10.00 / 1M input, $20.00 / 1M output tokens
- **Применение:** озвучка еженедельного подкаста
- **Аргументация:** Единственная доступная опция для TTS в прайс-листе

### 4. Vision (анализ фото): **gpt-realtime-mini**
- **Цена:** $0.80 / 1M image tokens, $0.60/$2.40 / 1M text tokens
- **Применение:** оценка внешнего вида по фото
- **Аргументация:** Mini-версия в 4-5 раз дешевле полного gpt-realtime, достаточно для простого анализа

---

## Детальный расчет (выборочно)

### Утреннее приветствие (самая дорогая функция)
**Частота:** 1 раз в день на пользователя
**Модели:** gpt-image-1-mini + gpt-5-mini

Пример расчета для недели 1 (1000 пользователей):
- Запросов: 1000 × 7 = 7000
- Изображения: 7000 × $0.01 = **$70.00**
- Текст (стих 500 символов ≈ 200 tokens output):
  - Input: 5000 символов (системный промпт) ≈ 2000 tokens × $0.25/1M = $0.0005/запрос
  - Output: 500 символов ≈ 200 tokens × $2.00/1M = $0.0004/запрос
  - Итого: 7000 × $0.0009 ≈ **$6.30**
- **Итого неделя 1:** $76.30

Рост на 8 недель: $76.30 → $129.71 (линейный рост пользователей)
**Итого за 8 недель: $824.04**

### Еженедельный подкаст
**Частота:** 1 раз в неделю на пользователя
**Модели:** gpt-5-mini (анализ) + gpt-realtime-mini-audio (TTS)

Пример для недели 1 (1000 пользователей):
- Анализ (вход: 7000 символов настроения за неделю, выход: 2000 символов текста):
  - Input: ~7800 tokens × $0.25/1M = $0.00195/запрос
  - Output: ~800 tokens × $2.00/1M = $0.00160/запрос
  - Итого: 1000 × $0.0028 = **$2.80**
- TTS (2000 символов ≈ 800 audio tokens):
  - Output: 800 tokens × $20.00/1M = $0.016/запрос
  - Итого: 1000 × $0.016 = **$16.00**
- **Итого неделя 1:** $18.80

**Итого за 8 недель: $203.04**

### Оценка внешнего вида
**Частота:** 1 раз в день на пользователя
**Модель:** gpt-realtime-mini (VLM)

Пример для недели 1 (1000 × 7 = 7000 запросов):
- Image input: 210 tokens × $0.80/1M = $0.000168/запрос
- Text input (промпт): 2000 tokens × $0.60/1M = $0.0012/запрос
- Text output: 240 tokens × $2.40/1M = $0.000576/запрос
- Итого: 7000 × $0.001944 = **$13.61**

**Итого за 8 недель: $146.97**

---

## Возможности дальнейшей оптимизации

1. **Кэширование изображений** (не учтено в расчете):
   - Повторное использование популярных картинок может снизить затраты на 20-30%

2. **Батч-обработка через Batch API**:
   - Скидка 50% на input/output для gpt-5-mini
   - Применимо к стихам и анализу настроения
   - Потенциальная экономия: ~$400 (снижение с $1256 до ~$850)

3. **Снижение частоты:**
   - Генерация стиха 3 раза в неделю вместо 7: экономия $470
   - Подкаст раз в 2 недели: экономия $100

---

## Проверка расчетов

Все расчеты реализованы в Python-скрипте [`calculate_cost.py`](calculate_cost.py).

**Запуск:**
```bash
python3 calculate_cost.py
```

**Источник данных:**
- Pricing: [Pricing _OpenAI.html](Pricing _OpenAI.html) (выкачанный 12.12.2025)
- Размеры текстов: [prilozhenie.xlsx](prilozhenie.xlsx)

**Ключевые допущения:**
- Русский текст: 1 токен ≈ 2.5 символа
- Изображение (512×512): 210 токенов
- Все пользователи активно используют все функции
- Не учтено кэширование (cached input tokens дешевле в 10 раз)

---

## Модель и история промптинга

**Модель для расчетов:** Claude Sonnet 4.5 (model ID: claude-sonnet-4-5-20250929)

**Промптинг:**
1. Извлечение ценовых данных из HTML (BeautifulSoup)
2. Чтение Excel с характеристиками функций (openpyxl)
3. Расчет токенов для русского текста (коэффициент 2.5 символа/токен)
4. Итерация по 8 неделям с линейным ростом пользователей
5. Агрегация по функциям и вывод итоговой сводки

**Результат:** Полностью автоматизированный скрипт с пояснениями выбора моделей.
